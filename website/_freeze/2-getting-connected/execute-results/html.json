{
  "hash": "2431d62ecd8522103ac0090f8d7370e8",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Getting Connected\"\nformat: html\nengine: knitr\n---\n\n::: {.cell}\n<style type=\"text/css\">\np {\n  text-align: justify\n}\n</style>\n:::\n\n\n\n\n\n\nThis chapter covers how to establish connections to DataSHIELD servers and assign data to your analysis session.\n\n## The DataSHIELD Workflow\n\nA typical DataSHIELD session follows this pattern:\n\n\n\n\n```{mermaid}\nflowchart LR\n    A[Build Login] --> B[Connect]\n    B --> C[Assign Data]\n    C --> D[Analyze]\n    D --> E[Logout]\n```\n\n\n\n\n## Loading Required Libraries\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Connection libraries\nlibrary(DSI)\nlibrary(DSOpal)\n\n# Analysis libraries\nlibrary(dsBaseClient)\nlibrary(dsTidyverseClient)\n```\n:::\n\n\n\n\n## Building Login Credentials\n\nUse the `DSLoginBuilder` to create your connection configuration.\n\n### Training Server Credentials\n\nFor this training, we use the public Opal demo server:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a new login builder\nbuilder <- DSI::newDSLoginBuilder()\n\n# Add the demo server\nbuilder$append(\n  server = \"demo\",\n  url = \"https://opal-demo.obiba.org\",\n  user = \"dsuser\",\n  password = \"P@ssw0rd\",\n  table = \"CNSIM.CNSIM1\",\n  profile = \"lemon-donkey\"\n)\n\n# Build the login data frame\nlogindata <- builder$build()\n```\n:::\n\n\n\n\n::: {.callout-important}\n## Profile: lemon-donkey\nWe use the `lemon-donkey` profile which includes additional packages for survival analysis (`dsSurvival`) and other advanced methods not available in the default profile.\n:::\n\n### Multiple Sites Example\n\nIn real federated analyses, you connect to multiple sites:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbuilder <- DSI::newDSLoginBuilder()\n\n# Site 1\nbuilder$append(\n  server = \"site1\",\n  url = \"https://opal-demo.obiba.org\",\n  user = \"dsuser\",\n  password = \"P@ssw0rd\",\n  table = \"CNSIM.CNSIM1\",\n  profile = \"lemon-donkey\"\n)\n\n# Site 2 (same server, different table for demo)\nbuilder$append(\n  server = \"site2\", \n  url = \"https://opal-demo.obiba.org\",\n  user = \"dsuser\",\n  password = \"P@ssw0rd\",\n  table = \"CNSIM.CNSIM2\",\n  profile = \"lemon-donkey\"\n)\n\nlogindata <- builder$build()\n```\n:::\n\n\n\n\n::: {.callout-tip}\n## Using Environment Variables (Production)\nFor production analyses, store credentials securely:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbuilder$append(\n  server = \"site1\",\n  url = Sys.getenv(\"OPAL_URL\"),\n  user = Sys.getenv(\"OPAL_USER\"),\n  password = Sys.getenv(\"OPAL_PASSWORD\"),\n  table = \"PROJECT.DATASET\",\n  profile = \"lemon-donkey\"\n)\n```\n:::\n\n\n\n:::\n\n## Connecting and Assigning Data\n\n### Basic Connection\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Connect and assign data to symbol \"D\"\nconns <- datashield.login(logins = logindata, assign = TRUE, symbol = \"D\")\n\n# Verify the connection\nds.ls()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$demo\n$demo$environment.searched\n[1] \"R_GlobalEnv\"\n\n$demo$objects.found\n[1] \"D\"\n```\n\n\n:::\n:::\n\n\n\n\n### Working with Resources\n\nFor resource-based data (e.g., files, databases), you assign a resource instead of a table:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Login with resource assignment\nbuilder <- DSI::newDSLoginBuilder()\nbuilder$append(\n  server = \"demo\",\n  url = \"https://opal-demo.obiba.org\",\n  user = \"dsuser\",\n  password = \"P@ssw0rd\",\n  resource = \"RSRC.CNSIM1\",\n  profile = \"lemon-donkey\"\n)\n\nlogindata <- builder$build()\nconns <- datashield.login(logins = logindata, assign = TRUE, symbol = \"res\")\n\n# Check the class of assigned object\nds.class(\"res\")\n\n# Convert resource to data frame\ndatashield.assign.expr(\n  conns, \n  symbol = \"D\",\n  expr = quote(as.resource.data.frame(res, strict = TRUE))\n)\n\n# Verify conversion\nds.class(\"D\")\nds.colnames(\"D\")\n```\n:::\n\n\n\n\n### Available Demo Datasets\n\nThe Opal demo server has several datasets available:\n\n| Project | Table/Resource | Description |\n|---------|---------------|-------------|\n| `CNSIM` | `CNSIM1`, `CNSIM2`, `CNSIM3` | Simulated health data (tables) |\n| `RSRC` | `CNSIM1`, `CNSIM2`, `CNSIM3` | Same data as resources |\n| `CORDELIA` | `cordelia45` | Cardiovascular study (resource) |\n| `GWAS` | `ega_phenotypes_1/2/3` | GWAS phenotype data |\n\n## Exploring Your Data\n\nOnce connected, explore what's available:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# List assigned objects\nds.ls()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$demo\n$demo$environment.searched\n[1] \"R_GlobalEnv\"\n\n$demo$objects.found\n[1] \"D\"\n```\n\n\n:::\n\n```{.r .cell-code}\n# Check data dimensions\nds.dim(\"D\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$`dimensions of D in demo`\n[1] 2163   11\n\n$`dimensions of D in combined studies`\n[1] 2163   11\n```\n\n\n:::\n\n```{.r .cell-code}\n# List column names\nds.colnames(\"D\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$demo\n [1] \"LAB_TSC\"            \"LAB_TRIG\"           \"LAB_HDL\"           \n [4] \"LAB_GLUC_ADJUSTED\"  \"PM_BMI_CONTINUOUS\"  \"DIS_CVA\"           \n [7] \"MEDI_LPD\"           \"DIS_DIAB\"           \"DIS_AMI\"           \n[10] \"GENDER\"             \"PM_BMI_CATEGORICAL\"\n```\n\n\n:::\n:::\n\n\n\n\n## Managing Sessions\n\n### Saving Workspaces\n\nSave your session for later:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Save workspace\ndatashield.workspace_save(conns, ws = \"my_analysis_2024\")\n\n# Logout\ndatashield.logout(conns)\n```\n:::\n\n\n\n### Restoring Workspaces\n\nResume a saved session:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Login and restore\nconns <- datashield.login(logins = logindata, restore = \"my_analysis_2024\")\n\n# Check what's available\nds.ls()\n```\n:::\n\n\n\n\n### Proper Logout\n\nAlways logout when finished:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Clean logout\ndatashield.logout(conns)\n```\n:::\n\n\n\n\n::: {.callout-warning}\n## Session Cleanup\nAlways logout properly to release server resources. Abandoned sessions consume memory and may prevent other users from connecting.\n:::\n\n\n\n\n\n\n\n\n\n## Next Steps\n\nNow that you're connected, proceed to [Filtering & Subsetting](3-filtering-subsetting.qmd) to start working with your data.\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}