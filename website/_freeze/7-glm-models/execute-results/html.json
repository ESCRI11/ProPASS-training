{
  "hash": "31ec93d517c1ce3ce531f6e7952217a5",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Generalized Linear Models\"\nformat: html\nengine: knitr\n---\n\n::: {.cell}\n<style type=\"text/css\">\np {\n  text-align: justify\n}\n</style>\n:::\n\n\n\n\nThis chapter covers fitting generalized linear models (GLM) using `ds.glm()` within the DataSHIELD framework.\n\n## Overview\n\nGeneralized linear models extend linear regression to handle various outcome types:\n\n- **Gaussian** (identity link): Continuous outcomes (linear regression)\n- **Binomial** (logit link): Binary outcomes (logistic regression)\n- **Poisson** (log link): Count data\n- **Gamma**: Positive continuous outcomes with right skew\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load required packages\nlibrary(DSI)\nlibrary(DSOpal)\nlibrary(dsBaseClient)\nlibrary(dsTidyverseClient)\n\n# Connect to the server\nbuilder <- DSI::newDSLoginBuilder()\nbuilder$append(\n  server = \"demo\",\n  url = \"https://opal-demo.obiba.org\",\n  user = \"dsuser\",\n  password = \"P@ssw0rd\",\n  table = \"CNSIM.CNSIM1\",\n  profile = \"lemon-donkey\"\n)\nlogindata <- builder$build()\nconns <- datashield.login(logins = logindata, assign = TRUE, symbol = \"D\")\n```\n:::\n\n\n\n\n## The ds.glm() Function\n\nBasic syntax:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel <- ds.glm(\n  formula = \"outcome ~ predictor1 + predictor2\",\n  data = \"D\",\n  family = \"gaussian\",  # or \"binomial\", \"poisson\", \"Gamma\"\n  viewIter = FALSE\n)\n```\n:::\n\n\n\n\n## Linear Regression (Continuous Outcomes)\n\n### Simple Linear Regression\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# BMI as a predictor of total cholesterol\nmodel_simple <- ds.glm(\n  formula = \"LAB_TSC ~ PM_BMI_CONTINUOUS\",\n  data = \"D\",\n  family = \"gaussian\"\n)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 1...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      61934.059686\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 2...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      2108.63554456376\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 3...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      2108.63554456376\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nSUMMARY OF MODEL STATE after iteration 3\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCurrent deviance 2108.63554456376 on 1734 degrees of freedom\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nConvergence criterion TRUE (0)\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nbeta: 5.79402724015325 0.00278425122047829\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nInformation matrix overall:\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n                  (Intercept) PM_BMI_CONTINUOUS\n(Intercept)           1736.00          47611.62\nPM_BMI_CONTINUOUS    47611.62        1348718.80\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nScore vector overall:\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n                           [,1]\n(Intercept)       -7.036149e-12\nPM_BMI_CONTINUOUS -1.923866e-10\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nCurrent deviance: 2108.63554456376\n```\n\n\n:::\n\n```{.r .cell-code}\n# View results\nmodel_simple$coefficients\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                     Estimate  Std. Error    z-value   p-value   low0.95CI\n(Intercept)       5.794027240 0.148364905 39.0525457 0.0000000  5.50323737\nPM_BMI_CONTINUOUS 0.002784251 0.005322864  0.5230739 0.6009228 -0.00764837\n                  high0.95CI\n(Intercept)       6.08481711\nPM_BMI_CONTINUOUS 0.01321687\n```\n\n\n:::\n:::\n\n\n\n\n### Multiple Linear Regression\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Cholesterol predicted by multiple factors\nmodel_multiple <- ds.glm(\n  formula = \"LAB_TSC ~ PM_BMI_CONTINUOUS + LAB_HDL + GENDER\",\n  data = \"D\",\n  family = \"gaussian\"\n)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 1...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      61595.4536\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 2...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      1996.60708106983\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 3...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      1996.60708106983\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nSUMMARY OF MODEL STATE after iteration 3\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCurrent deviance 1996.60708106983 on 1728 degrees of freedom\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nConvergence criterion TRUE (0)\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nbeta: 6.85318985113947 -0.00880153517619878 -0.474658587820022 -0.00610281948608032\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nInformation matrix overall:\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n                  (Intercept) PM_BMI_CONTINUOUS   LAB_HDL   GENDER1\n(Intercept)          1732.000          47418.98  2723.499   866.000\nPM_BMI_CONTINUOUS   47418.980        1339350.67 74131.285 23255.810\nLAB_HDL              2723.499          74131.29  4576.719  1406.812\nGENDER1               866.000          23255.81  1406.812   866.000\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nScore vector overall:\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n                          [,1]\n(Intercept)       1.125500e-11\nPM_BMI_CONTINUOUS 3.079172e-10\nLAB_HDL           1.760903e-11\nGENDER1           5.540457e-12\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nCurrent deviance: 1996.60708106983\n```\n\n\n:::\n\n```{.r .cell-code}\n# Extract coefficients\nmodel_multiple$coefficients\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                      Estimate  Std. Error    z-value       p-value   low0.95CI\n(Intercept)        6.853189851 0.190688944 35.9391043 7.490106e-283  6.47944639\nPM_BMI_CONTINUOUS -0.008801535 0.005366787 -1.6400010  1.010050e-01 -0.01932024\nLAB_HDL           -0.474658588 0.063586123 -7.4648141  8.341732e-14 -0.59928510\nGENDER1           -0.006102819 0.052301989 -0.1166843  9.071103e-01 -0.10861283\n                    high0.95CI\n(Intercept)        7.226933314\nPM_BMI_CONTINUOUS  0.001717173\nLAB_HDL           -0.350032076\nGENDER1            0.096407195\n```\n\n\n:::\n:::\n\n\n\n\n### Interpreting Results\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# The coefficients output includes:\n# - Estimate: the regression coefficient\n# - Std. Error: standard error of the estimate\n# - z-value: test statistic\n# - p-value: significance level\n\n# Example interpretation:\n# PM_BMI_CONTINUOUS coefficient = 0.05 means:\n# For each 1 unit increase in BMI, cholesterol increases by 0.05 units\n```\n:::\n\n\n\n\n## Logistic Regression (Binary Outcomes)\n\n### Simple Logistic Regression\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Diabetes predicted by BMI\nmodel_logistic <- ds.glm(\n  formula = \"DIS_DIAB ~ PM_BMI_CONTINUOUS\",\n  data = \"D\",\n  family = \"binomial\"\n)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 1...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      2864.08415007369\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 2...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      664.29240022525\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 3...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      376.697280364928\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 4...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      306.438153897246\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 5...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      292.639535998019\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 6...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      291.331982353567\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 7...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      291.314338097214\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 8...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      291.314334147146\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 9...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      291.314334147146\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nSUMMARY OF MODEL STATE after iteration 9\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCurrent deviance 291.314334147146 on 2064 degrees of freedom\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nConvergence criterion TRUE (7.80241905768514e-16)\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nbeta: -7.97564060620008 0.128164950163299\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nInformation matrix overall:\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n                  (Intercept) PM_BMI_CONTINUOUS\n(Intercept)          28.29673          871.4757\nPM_BMI_CONTINUOUS   871.47574        27750.8489\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nScore vector overall:\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n                          [,1]\n(Intercept)       3.356430e-13\nPM_BMI_CONTINUOUS 1.092246e-11\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nCurrent deviance: 291.314334147146\n```\n\n\n:::\n\n```{.r .cell-code}\n# Results are on log-odds scale\nmodel_logistic$coefficients\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                   Estimate Std. Error   z-value      p-value low0.95CI.LP\n(Intercept)       -7.975641 1.03735570 -7.688434 1.489471e-14 -10.00882041\nPM_BMI_CONTINUOUS  0.128165 0.03312513  3.869115 1.092312e-04   0.06324088\n                  high0.95CI.LP         P_OR low0.95CI.P_OR high0.95CI.P_OR\n(Intercept)           -5.942461 0.0003436165   4.499922e-05     0.002618685\nPM_BMI_CONTINUOUS      0.193089 1.1367404928   1.065283e+00     1.212990770\n```\n\n\n:::\n\n```{.r .cell-code}\n# Convert to odds ratios\nexp(model_logistic$coefficients[, \"Estimate\"])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      (Intercept) PM_BMI_CONTINUOUS \n     0.0003437346      1.1367404928 \n```\n\n\n:::\n:::\n\n\n\n\n### Multiple Logistic Regression\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Diabetes predicted by multiple risk factors\nmodel_diabetes <- ds.glm(\n  formula = \"DIS_DIAB ~ PM_BMI_CONTINUOUS + LAB_TSC + GENDER\",\n  data = \"D\",\n  family = \"binomial\"\n)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 1...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      2406.60701090413\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 2...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      560.909237342004\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 3...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      319.925807987188\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 4...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      260.761811075199\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 5...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      249.020431449224\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 6...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      247.965547009566\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 7...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      247.951679627053\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 8...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      247.951676112782\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 9...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      247.951676112781\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nSUMMARY OF MODEL STATE after iteration 9\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCurrent deviance 247.951676112781 on 1732 degrees of freedom\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nConvergence criterion TRUE (1.03121812713466e-15)\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nbeta: -8.17499120062243 0.121259330650184 0.0994449436744155 -0.38653486743053\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nInformation matrix overall:\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n                  (Intercept) PM_BMI_CONTINUOUS    LAB_TSC   GENDER1\n(Intercept)          24.27406          748.0070  147.42266   8.87059\nPM_BMI_CONTINUOUS   748.00701        23885.4256 4585.78813 262.28757\nLAB_TSC             147.42266         4585.7881  932.01485  52.21114\nGENDER1               8.87059          262.2876   52.21114   8.87059\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nScore vector overall:\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n                           [,1]\n(Intercept)       -1.602065e-13\nPM_BMI_CONTINUOUS -4.346995e-12\nLAB_TSC           -1.018725e-12\nGENDER1           -1.064578e-13\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nCurrent deviance: 247.951676112781\n```\n\n\n:::\n\n```{.r .cell-code}\n# Extract and format results\ncoefs <- model_diabetes$coefficients\nodds_ratios <- exp(coefs[, \"Estimate\"])\nci_lower <- exp(coefs[, \"Estimate\"] - 1.96 * coefs[, \"Std. Error\"])\nci_upper <- exp(coefs[, \"Estimate\"] + 1.96 * coefs[, \"Std. Error\"])\n\nresults <- data.frame(\n  OR = round(odds_ratios, 3),\n  CI_lower = round(ci_lower, 3),\n  CI_upper = round(ci_upper, 3),\n  p_value = round(coefs[, \"p-value\"], 4)\n)\n\nprint(results)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                     OR CI_lower CI_upper p_value\n(Intercept)       0.000    0.000    0.004  0.0000\nPM_BMI_CONTINUOUS 1.129    1.052    1.212  0.0008\nLAB_TSC           1.105    0.790    1.544  0.5606\nGENDER1           0.679    0.293    1.573  0.3670\n```\n\n\n:::\n:::\n\n\n\n\n## Adjusting for Confounders\n\n### Building Adjusted Models\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Unadjusted model\nmodel_unadj <- ds.glm(\n  formula = \"DIS_DIAB ~ PM_BMI_CONTINUOUS\",\n  data = \"D\",\n  family = \"binomial\"\n)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 1...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      2864.08415007369\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 2...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      664.29240022525\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 3...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      376.697280364928\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 4...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      306.438153897246\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 5...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      292.639535998019\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 6...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      291.331982353567\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 7...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      291.314338097214\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 8...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      291.314334147146\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 9...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      291.314334147146\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nSUMMARY OF MODEL STATE after iteration 9\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCurrent deviance 291.314334147146 on 2064 degrees of freedom\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nConvergence criterion TRUE (7.80241905768514e-16)\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nbeta: -7.97564060620008 0.128164950163299\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nInformation matrix overall:\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n                  (Intercept) PM_BMI_CONTINUOUS\n(Intercept)          28.29673          871.4757\nPM_BMI_CONTINUOUS   871.47574        27750.8489\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nScore vector overall:\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n                          [,1]\n(Intercept)       3.356430e-13\nPM_BMI_CONTINUOUS 1.092246e-11\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nCurrent deviance: 291.314334147146\n```\n\n\n:::\n\n```{.r .cell-code}\n# Gender adjusted\nmodel_adj1 <- ds.glm(\n  formula = \"DIS_DIAB ~ PM_BMI_CONTINUOUS + GENDER\",\n  data = \"D\",\n  family = \"binomial\"\n)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 1...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      2864.08415007369\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 2...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      664.091745207646\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 3...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      376.077873636942\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 4...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      305.060218021482\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 5...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      290.53336981469\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 6...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      289.008148333213\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 7...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      288.981069589415\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 8...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      288.981056969819\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 9...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      288.981056969815\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nSUMMARY OF MODEL STATE after iteration 9\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCurrent deviance 288.981056969815 on 2063 degrees of freedom\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nConvergence criterion TRUE (1.21913625413999e-14)\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nbeta: -7.46199544706331 0.119009703477005 -0.609693778835752\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nInformation matrix overall:\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n                  (Intercept) PM_BMI_CONTINUOUS    GENDER1\n(Intercept)         28.247764          869.6887   8.891516\nPM_BMI_CONTINUOUS  869.688718        27696.7482 261.610627\nGENDER1              8.891516          261.6106   8.891516\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nScore vector overall:\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n                           [,1]\n(Intercept)       -1.662210e-12\nPM_BMI_CONTINUOUS -4.706158e-11\nGENDER1           -1.632526e-12\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nCurrent deviance: 288.981056969815\n```\n\n\n:::\n\n```{.r .cell-code}\n# Adjusted for multiple factors\nmodel_adj2 <- ds.glm(\n  formula = \"DIS_DIAB ~ PM_BMI_CONTINUOUS + GENDER + LAB_TSC\",\n  data = \"D\",\n  family = \"binomial\"\n)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 1...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      2406.60701090413\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 2...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      560.909237342012\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 3...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      319.925807987189\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 4...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      260.761811075199\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 5...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      249.020431449225\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 6...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      247.965547009566\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 7...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      247.951679627053\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 8...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      247.951676112782\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 9...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      247.951676112781\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nSUMMARY OF MODEL STATE after iteration 9\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCurrent deviance 247.951676112781 on 1732 degrees of freedom\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nConvergence criterion TRUE (1.03121812713466e-15)\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nbeta: -8.17499120062243 0.121259330650184 -0.38653486743053 0.0994449436744149\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nInformation matrix overall:\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n                  (Intercept) PM_BMI_CONTINUOUS   GENDER1    LAB_TSC\n(Intercept)          24.27406          748.0070   8.87059  147.42266\nPM_BMI_CONTINUOUS   748.00701        23885.4256 262.28757 4585.78813\nGENDER1               8.87059          262.2876   8.87059   52.21114\nLAB_TSC             147.42266         4585.7881  52.21114  932.01485\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nScore vector overall:\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n                           [,1]\n(Intercept)       -8.427677e-14\nPM_BMI_CONTINUOUS -1.959183e-12\nGENDER1           -8.945318e-14\nLAB_TSC           -6.018311e-13\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nCurrent deviance: 247.951676112781\n```\n\n\n:::\n\n```{.r .cell-code}\n# Compare estimates across models\ncat(\"Unadjusted OR for BMI:\", round(exp(model_unadj$coefficients[\"PM_BMI_CONTINUOUS\", \"Estimate\"]), 3), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nUnadjusted OR for BMI: 1.137 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Gender-adjusted OR:\", round(exp(model_adj1$coefficients[\"PM_BMI_CONTINUOUS\", \"Estimate\"]), 3), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nGender-adjusted OR: 1.126 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Fully adjusted OR:\", round(exp(model_adj2$coefficients[\"PM_BMI_CONTINUOUS\", \"Estimate\"]), 3), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nFully adjusted OR: 1.129 \n```\n\n\n:::\n:::\n\n\n\n\n## Working with Factor Variables\n\n### Converting Variables to Factors\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Ensure categorical variables are factors\nds.asFactor(\"D$GENDER\", newobj = \"gender_f\")\nds.asFactor(\"D$DIS_DIAB\", newobj = \"diabetes_f\")\nds.asFactor(\"D$PM_BMI_CATEGORICAL\", newobj = \"bmi_cat_f\")\n\n# Add to data frame\nds.dataFrame(x = c(\"D\", \"gender_f\", \"diabetes_f\", \"bmi_cat_f\"), newobj = \"D_factors\")\n```\n:::\n\n\n\n\n### Using Factors in Models\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Model with factor predictors\nmodel_factors <- ds.glm(\n  formula = \"DIS_DIAB ~ PM_BMI_CONTINUOUS + gender_f\",\n  data = \"D_factors\",\n  family = \"binomial\"\n)\n\n# Each factor level (except reference) gets its own coefficient\nmodel_factors$coefficients\n```\n:::\n\n\n\n\n## Interaction Terms\n\n### Testing Interactions\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Interaction between BMI and gender\nmodel_interaction <- ds.glm(\n  formula = \"D$DIS_DIAB ~ D$PM_BMI_CONTINUOUS + D$GENDER + D$PM_BMI_CONTINUOUS:D$GENDER\",\n  family = \"binomial\"\n)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 1...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      2864.08415007369\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 2...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      663.64903038877\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 3...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      374.912930736829\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 4...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      303.419209135154\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 5...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      289.592337227501\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 6...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      288.353029162793\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 7...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      288.326338557291\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 8...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      288.326307172945\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIteration 9...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCURRENT DEVIANCE:      288.326307172892\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nSUMMARY OF MODEL STATE after iteration 9\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCurrent deviance 288.326307172892 on 2062 degrees of freedom\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nConvergence criterion TRUE (1.85453461829877e-13)\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nbeta: -7.92542541105242 0.133660437389928 1.27087964660502 -0.0637498408875636\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nInformation matrix overall:\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n                              (Intercept) D$PM_BMI_CONTINUOUS D$GENDER1\n(Intercept)                      28.15728            865.1230   8.91207\nD$PM_BMI_CONTINUOUS             865.12297          27575.7058 252.21723\nD$GENDER1                         8.91207            252.2172   8.91207\nD$PM_BMI_CONTINUOUS:D$GENDER1   252.21723           7347.2810 252.21723\n                              D$PM_BMI_CONTINUOUS:D$GENDER1\n(Intercept)                                        252.2172\nD$PM_BMI_CONTINUOUS                               7347.2810\nD$GENDER1                                          252.2172\nD$PM_BMI_CONTINUOUS:D$GENDER1                     7347.2810\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nScore vector overall:\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n                                       [,1]\n(Intercept)                   -2.709960e-11\nD$PM_BMI_CONTINUOUS           -6.415722e-10\nD$GENDER1                     -2.657315e-11\nD$PM_BMI_CONTINUOUS:D$GENDER1 -6.242105e-10\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nCurrent deviance: 288.326307172892\n```\n\n\n:::\n\n```{.r .cell-code}\nmodel_interaction$coefficients\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                                 Estimate Std. Error    z-value      p-value\n(Intercept)                   -7.92542541 1.21749187 -6.5096331 7.533457e-11\nD$PM_BMI_CONTINUOUS            0.13366044 0.03755315  3.5592341 3.719379e-04\nD$GENDER1                      1.27087965 2.32805373  0.5458979 5.851361e-01\nD$PM_BMI_CONTINUOUS:D$GENDER1 -0.06374984 0.07865359 -0.8105141 4.176448e-01\n                              low0.95CI.LP high0.95CI.LP         P_OR\n(Intercept)                   -10.31166563   -5.53918519 0.0003613055\nD$PM_BMI_CONTINUOUS             0.06005762    0.20726325 1.1430046321\nD$GENDER1                      -3.29202182    5.83378112 3.5639862323\nD$PM_BMI_CONTINUOUS:D$GENDER1  -0.21790804    0.09040836 0.9382396794\n                              low0.95CI.P_OR high0.95CI.P_OR\n(Intercept)                     3.324192e-05    3.914345e-03\nD$PM_BMI_CONTINUOUS             1.061898e+00    1.230306e+00\nD$GENDER1                       3.717860e-02    3.416481e+02\nD$PM_BMI_CONTINUOUS:D$GENDER1   8.041994e-01    1.094621e+00\n```\n\n\n:::\n:::\n\n\n\n\nThe interaction term `PM_BMI_CONTINUOUS:GENDER` tests whether the effect of BMI on diabetes risk differs between males and females.\n\n## Model Diagnostics\n\n### Checking Model Fit\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Deviance and degrees of freedom\nmodel_diabetes$dev  # Deviance\nmodel_diabetes$df   # Degrees of freedom\n\n# Number of valid observations\nmodel_diabetes$Nvalid\n```\n:::\n\n\n\n\n## Practical Example: Univariate and Multivariate Analysis\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# ============================================\n# Univariate Analysis (CNSIM Data)\n# ============================================\n\n# Model 1: Diabetes ~ BMI\nuni_bmi <- ds.glm(\n  formula = \"DIS_DIAB ~ PM_BMI_CONTINUOUS\",\n  data = \"D\",\n  family = \"binomial\"\n)\n\n# Model 2: Diabetes ~ Total Cholesterol\nuni_tsc <- ds.glm(\n  formula = \"DIS_DIAB ~ LAB_TSC\",\n  data = \"D\",\n  family = \"binomial\"\n)\n\n# Model 3: Diabetes ~ HDL\nuni_hdl <- ds.glm(\n  formula = \"DIS_DIAB ~ LAB_HDL\",\n  data = \"D\",\n  family = \"binomial\"\n)\n\n# Model 4: Diabetes ~ Triglycerides\nuni_trig <- ds.glm(\n  formula = \"DIS_DIAB ~ LAB_TRIG\",\n  data = \"D\",\n  family = \"binomial\"\n)\n\n# Collect univariate results\ncat(\"=== Univariate Analysis ===\\n\\n\")\ncat(\"BMI OR:\", round(exp(uni_bmi$coefficients[2, 1]), 3), \n    \"p =\", round(uni_bmi$coefficients[2, 4], 4), \"\\n\")\ncat(\"TSC OR:\", round(exp(uni_tsc$coefficients[2, 1]), 3), \n    \"p =\", round(uni_tsc$coefficients[2, 4], 4), \"\\n\")\ncat(\"HDL OR:\", round(exp(uni_hdl$coefficients[2, 1]), 3), \n    \"p =\", round(uni_hdl$coefficients[2, 4], 4), \"\\n\")\ncat(\"TRIG OR:\", round(exp(uni_trig$coefficients[2, 1]), 3), \n    \"p =\", round(uni_trig$coefficients[2, 4], 4), \"\\n\")\n\n# ============================================\n# Multivariate Analysis\n# ============================================\n\nmulti_model <- ds.glm(\n  formula = \"DIS_DIAB ~ PM_BMI_CONTINUOUS + LAB_TSC + LAB_HDL + GENDER\",\n  data = \"D\",\n  family = \"binomial\"\n)\n\ncat(\"\\n=== Multivariate Analysis ===\\n\")\nprint(multi_model$coefficients)\n```\n:::\n\n\n\n\n## Reporting Results\n\n### Creating Publication-Ready Tables\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Format model results\nformat_glm_results <- function(model, family = \"binomial\") {\n  coefs <- model$coefficients\n  \n  if (family == \"binomial\") {\n    results <- data.frame(\n      Variable = rownames(coefs),\n      OR = round(exp(coefs[, \"Estimate\"]), 2),\n      CI_95 = paste0(\n        round(exp(coefs[, \"Estimate\"] - 1.96 * coefs[, \"Std. Error\"]), 2),\n        \"-\",\n        round(exp(coefs[, \"Estimate\"] + 1.96 * coefs[, \"Std. Error\"]), 2)\n      ),\n      p = ifelse(coefs[, \"p-value\"] < 0.001, \"<0.001\", \n                 round(coefs[, \"p-value\"], 3))\n    )\n  } else {\n    results <- data.frame(\n      Variable = rownames(coefs),\n      Beta = round(coefs[, \"Estimate\"], 3),\n      SE = round(coefs[, \"Std. Error\"], 3),\n      p = ifelse(coefs[, \"p-value\"] < 0.001, \"<0.001\",\n                 round(coefs[, \"p-value\"], 3))\n    )\n  }\n  \n  return(results)\n}\n\n# Usage\nformatted <- format_glm_results(multi_model, family = \"binomial\")\nprint(formatted)\n```\n:::\n\n\n\n\n## ProPASS Script Workflow\n\n::: {.callout-note}\n## ProPASS Data\nThe ProPASS analysis uses different variables than the CNSIM demo data. Here's how GLM models are used with ProPASS data:\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Convert categorical variables to factors\nds.asFactor(input.var.name = \"D$edu\", newobj.name = \"edu\")\nds.asFactor(input.var.name = \"D$smoke\", newobj.name = \"smoke\")\nds.asFactor(input.var.name = \"D$sex\", newobj.name = \"sex\")\n\n# Multivariate logistic regression with ProPASS covariates\nmodel_propass <- ds.glm(\n  formula = \"acm ~ bmi + age + sex + smoke + edu + alc + med_combined + diet\",\n  data = \"D\",\n  family = \"binomial\"\n)\n\n# Extract odds ratios\nexp(model_propass$coefficients[, \"Estimate\"])\n```\n:::\n\n\n\n\n## Best Practices\n\n::: {.callout-tip}\n## GLM Modeling Tips\n\n1. **Check variable types**: Ensure factors are properly coded with `ds.asFactor()`\n2. **Start simple**: Begin with univariate analyses\n3. **Build progressively**: Add confounders stepwise\n4. **Check multicollinearity**: Avoid highly correlated predictors\n5. **Report consistently**: Include OR, 95% CI, and p-values\n:::\n\n## Exercise\n\nUsing the CNSIM data:\n\n1. Fit a univariate logistic regression of `DIS_DIAB` on `PM_BMI_CONTINUOUS`\n2. Fit a univariate logistic regression of `DIS_DIAB` on `LAB_TSC`\n3. Build a multivariate model with BMI, cholesterol, HDL, and gender\n4. Test for an interaction between BMI and gender\n5. Report your results in a publication-ready table with odds ratios and 95% CIs\n\n\n\n\n\n\n\n\n\n## Next Steps\n\nContinue to [Survival Analysis](8-survival-analysis.qmd) to learn about time-to-event modelling.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}