{
  "hash": "4ee8eb85c3301a1b4979bc62d777f122",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Filtering & Subsetting\"\nformat: html\nengine: knitr\n---\n\n::: {.cell}\n<style type=\"text/css\">\np {\n  text-align: justify\n}\n</style>\n:::\n\n\n\n\nThis chapter covers techniques for filtering and subsetting datasets in DataSHIELD based on specified conditions.\n\n## Overview\n\nIn DataSHIELD, you cannot directly view individual-level data, but you can create subsets based on conditions. We use the tidyverse-style functions from `dsTidyverseClient`:\n\n- `ds.filter()` - Filter rows based on conditions\n- `ds.select()` - Select specific columns\n- `ds.arrange()` - Sort data by columns\n- `ds.dataFrameSubset()` - Subset with comparison operators (from dsBaseClient)\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load required packages\nlibrary(DSI)\nlibrary(DSOpal)\nlibrary(dsBaseClient)\nlibrary(dsTidyverseClient)\n\n# Connect to the server\nbuilder <- DSI::newDSLoginBuilder()\nbuilder$append(\n  server = \"demo\",\n  url = \"https://opal-demo.obiba.org\",\n  user = \"dsuser\",\n  password = \"P@ssw0rd\",\n  table = \"CNSIM.CNSIM1\",\n  profile = \"margin-idiom\"\n)\nlogindata <- builder$build()\nconns <- datashield.login(logins = logindata, assign = TRUE, symbol = \"D\")\n```\n:::\n\n\n\n\n## Filtering Rows with ds.filter()\n\nFilter rows based on conditions using familiar tidyverse syntax:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Filter for participants with BMI >= 25\nds.filter(\n  df.name = \"D\",\n  tidy_expr = list(D$PM_BMI_CONTINUOUS >= 25),\n  newobj = \"D_overweight\"\n)\n\n# Check how many rows remain\nds.dim(\"D_overweight\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$`dimensions of D_overweight in demo`\n[1] 1425   11\n\n$`dimensions of D_overweight in combined studies`\n[1] 1425   11\n```\n\n\n:::\n:::\n\n\n\n\n### Multiple Conditions\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Filter for BMI between 20 and 35\nds.filter(\n  df.name = \"D\",\n  tidy_expr = list(D$PM_BMI_CONTINUOUS >= 20, D$PM_BMI_CONTINUOUS <= 35),\n  newobj = \"D_bmi_range\"\n)\n\nds.dim(\"D_bmi_range\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$`dimensions of D_bmi_range in demo`\n[1] 1809   11\n\n$`dimensions of D_bmi_range in combined studies`\n[1] 1809   11\n```\n\n\n:::\n:::\n\n\n\n\n## Selecting Columns with ds.select()\n\nSelect specific columns from your data frame:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Select variables needed for analysis\nds.select(\n  df.name = \"D\",\n  tidy_expr = list(PM_BMI_CONTINUOUS, LAB_TSC, LAB_HDL, LAB_TRIG, GENDER, DIS_DIAB),\n  newobj = \"D_selected\"\n)\n\n# Check the result\nds.colnames(\"D_selected\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$demo\n[1] \"PM_BMI_CONTINUOUS\" \"LAB_TSC\"           \"LAB_HDL\"          \n[4] \"LAB_TRIG\"          \"GENDER\"            \"DIS_DIAB\"         \n```\n\n\n:::\n:::\n\n\n\n\n## Sorting Data with ds.arrange()\n\nSort your data by one or more columns:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Sort by BMI\nds.arrange(\n  df.name = \"D\",\n  tidy_expr = list(PM_BMI_CONTINUOUS),\n  newobj = \"D_sorted\"\n)\n\nds.dim(\"D_sorted\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$`dimensions of D_sorted in demo`\n[1] 2163   11\n\n$`dimensions of D_sorted in combined studies`\n[1] 2163   11\n```\n\n\n:::\n:::\n\n\n\n\n## Subsetting with ds.dataFrameSubset()\n\nFor subsetting based on comparison operators, use `ds.dataFrameSubset()`:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Keep only participants with BMI >= 25\nds.dataFrameSubset(\n  df.name = \"D\",\n  V1.name = \"D$PM_BMI_CONTINUOUS\",\n  V2.name = \"25\",\n  Boolean.operator = \">=\",\n  newobj = \"D_bmi25plus\"\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Check how many participants remain\nds.dim(\"D_bmi25plus\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$`dimensions of D_bmi25plus in demo`\n[1] 1425   11\n\n$`dimensions of D_bmi25plus in combined studies`\n[1] 1425   11\n```\n\n\n:::\n:::\n\n\n\n\n### Available Operators\n\n| Operator | Description |\n|----------|-------------|\n| `==` | Equal to |\n| `!=` | Not equal to |\n| `<` | Less than |\n| `<=` | Less than or equal |\n| `>` | Greater than |\n| `>=` | Greater than or equal |\n\n## Complete Case Analysis\n\nRemove rows with any missing values:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nds.completeCases(\n  x1 = \"D\",\n  newobj = \"D_complete\"\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nds.dim(\"D_complete\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$`dimensions of D_complete in demo`\n[1] 1701   11\n\n$`dimensions of D_complete in combined studies`\n[1] 1701   11\n```\n\n\n:::\n:::\n\n\n\n\n## Best Practices\n\n::: {.callout-tip}\n## Subsetting Guidelines\n1. **Sort your data first**: Use `ds.arrange()` to ensure consistent ordering\n2. **Filter early**: Remove missing/invalid data before other operations\n3. **Check dimensions**: Always verify sample sizes after filtering\n4. **Document your filters**: Keep track of exclusion criteria\n5. **Consider disclosure**: Very small subsets may fail privacy checks\n:::\n\n\n\n\n\n\n\n\n\n## Next Steps\n\nContinue to [Conditional Operations](4-conditional-operations.qmd) to learn about creating conditional variables.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}